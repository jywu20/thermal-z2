\documentclass[hyperref, a4paper]{article}

\usepackage{geometry}
\usepackage{titling}
\usepackage{titlesec}
\usepackage{paralist}
\usepackage{footnote}
\usepackage{enumerate}
\usepackage{amsmath, amssymb, amsthm, bm}
\usepackage{mathtools}
\usepackage{mathdots}
\usepackage{cite}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{subcaption}
\usepackage{physics}
\usepackage{siunitx}
\usepackage[version=4]{mhchem}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{autobreak}
\usepackage[ruled, vlined, linesnumbered]{algorithm2e}
\usepackage[colorlinks]{hyperref} % , linkcolor=black, anchorcolor=black, citecolor=black, urlcolor=black
\usepackage{prettyref}

% Page style
\geometry{left=3.18cm,right=3.18cm,top=2.54cm,bottom=2.54cm}
\titlespacing{\paragraph}{0pt}{1pt}{10pt}[20pt]
\setlength{\droptitle}{-5em}
\preauthor{\vspace{-10pt}\begin{center}}
\postauthor{\par\end{center}}

% Math operators
\DeclareMathOperator{\timeorder}{T}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\legpoly}{P}
\DeclareMathOperator{\primevalue}{P}
\DeclareMathOperator{\sgn}{sgn}
\newcommand*{\ii}{\mathrm{i}}
\newcommand*{\ee}{\mathrm{e}}
\newcommand*{\const}{\mathrm{const}}
\newcommand*{\suchthat}{\quad \text{s.t.} \quad}
\newcommand*{\argmin}{\arg\min}
\newcommand*{\argmax}{\arg\max}
\newcommand*{\normalorder}[1]{: #1 :}
\newcommand*{\pair}[1]{\langle #1 \rangle}
\newcommand*{\fd}[1]{\mathcal{D} #1}
\DeclareMathOperator{\bigO}{\mathcal{O}}

% TikZ setting
\usetikzlibrary{arrows,shapes,positioning}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{decorations.markings}
\tikzstyle arrowstyle=[scale=1]
\tikzstyle directed=[postaction={decorate,decoration={markings,
    mark=at position .5 with {\arrow[arrowstyle]{stealth}}}}]
\tikzstyle ray=[directed, thick]
\tikzstyle dot=[anchor=base,fill,circle,inner sep=1pt]

% Algorithm setting
% Julia-style code
\SetKwIF{If}{ElseIf}{Else}{if}{}{elseif}{else}{end}
\SetKwFor{For}{for}{}{end}
\SetKwFor{While}{while}{}{end}
\SetKwProg{Function}{function}{}{end}
\SetArgSty{textnormal}

\newcommand*{\concept}[1]{{\textbf{#1}}}

\lstset{basicstyle=\ttfamily,
  showstringspaces=false,
  commentstyle=\color{gray},
  keywordstyle=\color{blue}
}

\newcommand*{\Ztwo}{\texorpdfstring{$\mathbb{Z}_2$ }{Z2 }}
\newcommand*{\tfim}{transverse field Ising model}
\newcommand*{\cim}{classical Ising model}

% Disable unsupported commands in bookmark titles 
\pdfstringdefDisableCommands{%
  \def\\{}%
  \def\texttt#1{<#1>}%
  \def\mathbb#1{#1}%
}
\pdfstringdefDisableCommands{\def\eqref#1{(\ref{#1})}}

\makeatletter
\pdfstringdefDisableCommands{\let\HyPsd@CatcodeWarning\@gobble}
\makeatother

\title{\Ztwo Gauge Field Coupled to a Fermion System}
\author{Jinyuan Wu}

\begin{document}

\maketitle

In the whole article we use $\sigma$ and $s$ as shorthands of $\sigma^z$ and $s^z$, unless confusion may be caused by the notation.

\section{The model Hamiltonian}

The model investigated in this article is shown in \cite{moon2019deconfined}.
The model Hamiltonian is 
\begin{equation}
    H = \underbrace{- g \sum_{\vb*{i}} \prod_{\vb*{l} \in \Box_{\vb*{i}^*}} \sigma_{\vb*{l}}^z - h \sum_{\pair{\vb*{i}, \vb*{j}}} \sigma^x_{\vb*{i} \vb*{j}}}_{H_Z} \underbrace{- J \sum_{\pair{\vb*{i}, \vb*{j}}} \sigma_{\vb*{i} \vb*{j}} s_{\vb*{i}} s_{\vb*{j}} + \sum_i h^x_i s^x_i}_{H_\text{Ising}} \underbrace{- t \sum_{\pair{\vb*{i}, \vb*{j}}} \sigma_{\vb*{i} \vb*{j}} c^\dagger_{\vb*{i}} c_{\vb*{j}}}_{H_\text{hopping}},
    \label{eq:proposed-model}
\end{equation}
where $\vb*{i}^*$ is a site in the dual lattice (i.e. a site placed at the center of a plaquette), 
$\Box_{\vb*{i}^*}$ is the plaquette whose center is $\vb*{i}^*$, and $\vb*{l}$ denotes a certain bond of a plaquette.
Such kind of model Hamiltonian usually emerges from orthogonal metals \cite{moon2019deconfined, orthogonal_metal}.

The author of \cite{moon2019deconfined} claims that 
\begin{itemize}
    \item The model \eqref{eq:proposed-model} shows ``deconfined \emph{thermal} phase transitions with \Ztwo structures''. 
    \item The mechanism for a thermal phase transition in a \Ztwo theory is that deconfined fermions coupled to the \Ztwo gauge field introduces effective interaction between \Ztwo charges.
    \item % TODO
\end{itemize}
We think the author's argument is flawed; yet the model is still interesting and is worth some investigation.

In this section, we introduce every part of \eqref{eq:proposed-model}.

\subsection{\Ztwo gauge field and its dual theories}

\subsubsection{The plaquette term}

\begin{figure}
    \centering
    \input{lattice/gauge-plaquette.tex}
    \caption{A \Ztwo gauge field configuration. The blue plaquette's $F_{\vb*{i}^*}$ is $(-1) \times 1 \times (-1) \times (-1) = -1$, %
    while the red plaquette's $F_{\vb*{i}^*}$ is $1 \times 1 \times (-1) \times (-1) = 1$. %
    Note that we assign the same index to a plaquette's center (labeled as $\vb*{i}^*$ at the right top of the diagram) %
    and the plaquette's left bottom site $\vb*{i}$. %
    The terms ``up'' and ``down'' are defined in the Cartesian coordinates given in the diagram.}
    \label{fig:z2-gauge-field}
\end{figure}

The plaquette term in the Hamiltonian of the \Ztwo gauge field is be a function of
\begin{equation}
    F_{i^*} = \prod_{l \in \Box_{i^*}} \sigma_l,
\end{equation}
which is invariant under a \Ztwo gauge transformation
\begin{equation}
    Q_{\vb*{i}} = \prod_{\vb*{l} \in +_{\vb*{i}}} \sigma^x_{\vb*{l}}.
\end{equation}
A convenient convention is to let a plaquette share the same index with the site in its left bottom corner. 
An example of a \Ztwo gauge field configuration can be found in \prettyref{fig:z2-gauge-field}.

\subsubsection{The transverse field}

We name the \Ztwo gauge theory with plaquette terms only as the \concept{Wegner model}, i.e.
\begin{equation}
    H_\text{W} = - g \sum_{\vb*{i}} F_{{\vb*{i}}^*}.
\end{equation}
There is no quantum fluctuation in $H_\text{W}$. 
The existence of interaction between the \Ztwo field and the Ising field and the fermions introduces effective interaction channels between \Ztwo excitations, but all effective interaction between \Ztwo excitations are in terms of $\sigma^z_{\vb*{i} \vb*{j}}$, which commutes with $H_Z$ and therefore do not bring in quantum fluctuation.

An idiomatic way to add quantum fluctuation is to add a transverse field.
In this project we consider a transverse field Hamiltonian in the form of 
\begin{equation}
    H_h = - h \sum_{\pair{\vb*{i}, \vb*{j}}} \sigma_{\vb*{i} \vb*{j}}^x ,
    \label{eq:transverse-field}
\end{equation}
where the parameter $h$ measures the quantum fluctuation.
\eqref{eq:transverse-field} obviously commutes with $\vb*{Q}_{\vb*{i}}$ for every $\vb*{i}$, so it can be a term in a \Ztwo gauge invariant Hamiltonian. 
In the language of string-net condensation, $H_h$ is a string tension term.
So when we say ``\Ztwo gauge theory'', usually we are referring to 
\begin{equation}
    H = - J \sum_{\vb*{i}} \prod_{\vb*{l} \in \Box_{\vb*{i}^*}} \sigma^z_{\vb*{l}} - h \sum_{\pair{\vb*{i}, \vb*{j}}} \sigma_{\vb*{i} \vb*{j}}^x.
    \label{eq:standard-z2-theory}
\end{equation}

\subsubsection{Equivalence between a \Ztwo gauge theory when $h = 0$ and a bundle of Ising chains}

Now we consider a \Ztwo field theory with the plaquette term only, or in other words, we investigate the Wegner model.
With the gauge choice
\begin{equation}
    \sigma_{\vb*{i}, \vb*{i}+\vu*{x}} = 1,
    \label{eq:gauge-choice-x}
\end{equation}
a \Ztwo flux is 
\begin{equation}
    F_{\vb*{i}^*} = \sigma_{\vb*{i}, \vb*{i}+\vu*{y}} \sigma_{\vb*{i}+\vu*{x}, \vb*{i} + \vu*{x} + \vu*{y}},
\end{equation}
which, by renaming $\sigma_{\vb*{i}, \vb*{i}+\vu*{y}}$ into $S_{\vb*{i}}$, reads 
\begin{equation}
    F_{\vb*{i}^*} = S_{\vb*{i}} S_{\vb*{i}+\hat{x}}.
\end{equation}
The hopping constant $\sigma_{\vb*{i} \vb*{j}}$, respectively, is
\begin{equation}
    \sigma_{\vb*{i} \vb*{j}} = \left\{
    \begin{aligned}
        1, &\quad \vb*{j} = \vb*{i} + \vu*{x}, \\
        S_{\vb*{i}}, &\quad \vb*{j} = \vb*{i} + \vu*{y},
    \end{aligned}
\right., \quad \sigma_{\vb*{j} \vb*{i}} = \sigma_{\vb*{i} \vb*{j}}.
\end{equation}

This, actually, means that the \Ztwo gauge field may also be transformed into a dual transverse field Ising field.
For example consider Wegner model.
With the definition of the equivalent Ising spins $S_{\vb*{i}}$ the Wegner model is rephrased into
\begin{equation}
    H_\text{W} = - J \sum_{\vb*{i}} \underbrace{\prod_{\vb*{l} \in \Box_{\vb*{i}^*}} \sigma_{\vb*{l}}}_{F_{\vb*{i}^*}} = -J \sum_{\vb*{i}} S_{\vb*{i}} S_{\vb*{i}+\vu*{x}},
\end{equation}
so the model is actually a bundle of 1D Ising spin chain.

\begin{figure}
    \centering
    \input{lattice/gauge-to-spin-chain.tex}
    \caption{Converting a \Ztwo gauge field theory into a bundle of Ising chains. There is no interaction between parallel Ising chains.}
\end{figure}

\subsubsection{Mapping a \Ztwo gauge theory into a 2D \tfim{}}

Note that the gauge fixing \eqref{eq:gauge-choice-x} fails with a non-zero $h$.
Therefore, while it is tempting to write down 
\begin{equation}
    H = - J \sum_{\vb*{i}} S_{\vb*{i}}^z S^z_{\vb*{i} + \vu*{x}} - h \sum_{\vb*{i}} {S}^z_{\vb*{i}}
\end{equation}
as an equivalent Hamiltonian of \eqref{eq:standard-z2-theory}, we cannot.
The transverse field term \emph{does not commute} with $\sigma_{\vb*{i}, \vb*{i} + \vu*{x}}$ and therefore 
gauge fixing \eqref{eq:gauge-choice-x} is not a consistent choice.

We can still recast \eqref{eq:standard-z2-theory} into a \tfim{}, but generally speaking we can only recast it into a 2D one.

\begin{equation}
    H = - h \sum_{\pair{\vb*{I}, \vb*{J}}} \tau^z_{\vb*{I}} \tau^z_{\vb*{J}} - J \sum_{\vb*{I}} \tau^x_{\vb*{I}}.
    \label{eq:z2-dual-theory}
\end{equation}
\eqref{eq:z2-dual-theory} is often called the \concept{dual \tfim{}} of \Ztwo gauge theory \eqref{eq:standard-z2-theory}.
The model \eqref{eq:standard-z2-theory}, therefore, is often called the \concept{Ising gauge theory}.

Note that the \Ztwo fluxes cannot be locally calculated with $\tau^x$ and $\tau^z$. 
Therefore, although with \eqref{eq:z2-dual-theory} we manage to eliminate the gauge redundancy in \eqref{eq:standard-z2-theory},
we \emph{should not} do so when the \Ztwo degrees of freedom are coupled to other degrees of freedom.
For example, in \eqref{eq:proposed-model}, the deconfined fermions are coupled to $\sigma^z$ and 
we do not have a local expression of $\sigma^z$ in terms of degrees of freedom in \eqref{eq:z2-dual-theory}.

\subsubsection{Absence of a finite temperature deconfined phase}\label{sec:absence-of-z2-deconfined-phase}

When $T=0$ and $h \ll g$, the \Ztwo gauge field exhibits a \emph{deconfined} phase, i.e. there are freely moving \Ztwo excitations such as \Ztwo fluxes.

When $h = 0$, the absence of quantum fluctuation here means the model is indeed totally classical, so there is no thermal phase transition, because a 1D Ising chain does not show thermal phase transition.
On the other hand, we know when $T=0$ the model exhibits deconfined \Ztwo charges, and when a transverse field is introduced a zero temperature quantum phase transition can be observed from the deconfined phase into the confined phase as the transverse field grows.
If for $T > 0$ there exists a deconfined phase, a simple analysis of the phase diagram tells us there must be a thermal phase transition when there is no transverse field.
The fact that Wegner model is dual to a bundle of 1D Ising chain and therefore lacks thermal phase transition implies that no deconfined phase exists with finite non zero temperature.

\begin{figure}
    \centering
    \input{phase/no-deconfined.tex}
    \caption{No deconfined phase when $T > 0$: if there is a deconfined phase when $T > 0$, there must be a thermal phase transition at the $h=0$ line, which is forbidden by the fact that a classical 1D Ising chain does not show thermal phase transitions.}
    \label{fig:phase-diagram-expected-pure-z2}
\end{figure}

Here the terminology may cause confusion: we do not actually know if the ``finite temperature deconfined'' phase shares behavior with the standard zero temperature deconfined phase in Wegner model, and the ``confined'' phase in the high temperature condition is not caused by a strong transverse field which coerces all $\sigma$ degrees of freedom into $\rightarrow$ or $\leftarrow$, but rather, by thermal fluctuation that erases all information of \Ztwo excitations.
With the criteria of Wilson loops we know the ``deconfined'' phase obeys the perimeter law, agreeing with the ordinary deconfined phase in Wegner model, but whether the Wilson loop operator is a good detector in non-local models is still under question, because in local models, existence of long range correlation indicates exotic phenomena, while in non-local models long range correlation may be a trivial consequence of the non-locality.
All these questions remain open, and in this project we simply use the terms ``confined'' and ``deconfined'' as a shorthand of the two phases in a \Ztwo gauge field theory with a dual theory of Dyson-Ising spin chains, without inquiring into their similarity and discrepancy with local \Ztwo theories such as Wegner model.

\subsubsection{(Trivial) deconfined phase in models with long-range interaction}

If we are to extend the deconfined phase to $T>0$, at least some stronger correlation must be introduced.
Without introducing quantum fluctuation, a reasonable proposal may be 
\[
    H_Z = - \sum_i \sum_{r=1}^\infty J(r) \prod_{a=0}^{r-1} F_{i^*+a \hat{x}},
\]
or in terms of $S_i$s,
\[
    H_Z = - \sum_{r=1}^\infty J(r) \sum_i S_i S_{i + r \hat{x}} ,
\]
which is again a bundle of spin chains without quantum fluctuation but this time with long range interaction.
A famous example is the \concept{Dyson-Ising chain}, which is defined as
\[
    H_Z = - g \sum_i S_i S_{i+\hat{x}} - J_r \sum_{\vb*{i}} \sum_r \frac{S_i S_{i + r \hat{x}}}{r^\omega}.
\]
For 1D Ising chain with long-range interaction, there exists a thermal phase transition with zero transverse field, and indeed we get a deconfined phase with finite temperature, and as the temperature goes up the deconfined phase switches to the confined phase.

However, the so-called deconfined phase of a long-range interacting model is not of particular interest, because if you put manually something long-range into a model, \emph{of course} it exhibits some long-range behaviors, for example Wilson loops obeying the perimeter law.
That is why we call such a ``deconfined phase'' a trivial one.
Despite its triviality, ``deconfined'' phases in long-range models give us a hint that strong interaction between \Ztwo fluxes is important for a thermal deconfined phase.
A natural question to ask is, if we introduce more things into the model to induce effective interaction channels between \Ztwo fluxes, what happens when $T > 0$?

\subsection{Orthogonal metals, emergent fermions and an Ising field}

\subsubsection{Fermion fractionalization in orthogonal metals and the effective model}

Orthogonal metal is a type of fractionalized electron systems where an electron is split into another fermion and an Ising spin, i.e.
\begin{equation}
    c^\dagger_{\vb*{i} \alpha} = f^\dagger_{\vb*{i} \alpha} \sigma^z_{\vb*{i}}, 
    \label{eq:orthogonal-metal-ansatz}
\end{equation}
where $f$ operators and $\sigma^z$ operators commute and $f^\dagger_{\vb*{i} \alpha}$ fermions can move around freely. 
Since the Hilbert space spanned by the $f$ fermions and Ising spins are larger than the original electronic system's Hilbert space, certain constraints must be imposed, resulting in an emergent gauge field, gluing up $f$ and $\sigma$ fields.

That justifies the way we construct \eqref{eq:proposed-model}.
Suppose we have a tight-binding electron models with certain interaction channels that are strong enough to create a non-Fermi liquid phase, the Hamiltonian of which is 
\begin{equation}
    H = - t \sum_{\pair{\vb*{i}, \vb*{j}}, \alpha} c^\dagger_{\vb*{i} \alpha} c_{\vb*{j} \alpha} + \sum_{\vb*{i}, \vb*{j}} V_{\vb*{i} \vb*{j}} n_{\vb*{i}} n_{\vb*{j}}.
    \label{eq:electron-hamiltonian}
\end{equation}
Substituting \eqref{eq:orthogonal-metal-ansatz} into \eqref{eq:electron-hamiltonian} and doing necessary mean field approximations, we find that the Hamiltonian about $f$ fermions in the model is also a tight-binding Hamiltonian with its hopping constants being the same as $\sigma_{\vb*{i} \vb*{j}}$, which couples the fermions with the \Ztwo gauge field, endowing the fermions \Ztwo charges.

The idea of orthogonal metals gives us an approach to find a local \Ztwo gauge model that shows deconfined phase at finite temperature.
Our logic is the inverse of the derivation of orthogonal metals: if an orthogonal metal with \Ztwo gauge structure does exist, then it can be described by \eqref{eq:proposed-model}.
That implies the existence of a model Hamiltonian in the form of \eqref{eq:proposed-model} with a deconfined phase.
Our goal is, therefore, to check under what condition \eqref{eq:proposed-model} \emph{can never} be in a deconfined phase.

\subsubsection{Confined phase in orthogonal metals}

When the \Ztwo charges get trapped into a confined phase, it can be expected that the fermions and the Ising spins are also confined.
Note that what the composite particles generated by the gauge field as a glue in the confined phase are is not quite clear.
One possibility is that the fermions are glued together, forming something like Cooper pairs, where the fermion excitations are now gapped.
Nonetheless, note that orthogonal metals are generated in a strongly correlated \emph{electron} systems, so it is highly likely that \emph{one fermion and one Ising spin} are glued together, restoring the electrons.
In this case, the confined phase is just an ordinary metal, with gapless fermions (electrons).
At high temperature \Ztwo excitations are confined (in the sense defined in \prettyref{sec:absence-of-z2-deconfined-phase}), so \eqref{eq:proposed-model} is just an ordinary metal.

\subsubsection{Deconfined phase and effective interaction between \Ztwo fluxes}

\begin{figure}
    \centering
    \input{lattice/string-fluxes.tex}
    \caption{Two \Ztwo fluxes and the string connecting them. 
    This configuration may change the total energy of the gas of deconfined fermions, 
    therefore inducing an effective interaction channel between \Ztwo fluxes.}
\end{figure}

\section{Principles of Monte Carlo simulation for degrees of freedom in \eqref{eq:proposed-model}}

We are going to study \eqref{eq:proposed-model} numerically.
In the partition function, the (non-normalized) weight of a configuration is $\mel{n}{\ee^{-\beta H}}{n}$, given that $\{\ket{n}\}$ is a basis.

In this section we discuss how degrees of freedom in the model can be simulated in quantum Monte Carlo methods.
We can use discrete path integral methods or maybe SSE to evaluate these weights.

\subsection{The 2D \tfim{}}

\subsubsection{From 2D \tfim{} to 3D \cim: discrete path integral and Metropolis update}

\begin{figure}
    \centering
    \begin{subfigure}{0.48\textwidth}
        \includegraphics[width=\textwidth]{../analytical/jxy-jtau-ratio/ratio-h-0.001-dtau-0.02.PNG}
        \subcaption{$h = 0.001$}
    \end{subfigure}
    \begin{subfigure}{0.48\textwidth}
        \includegraphics[width=\textwidth]{../analytical/jxy-jtau-ratio/ratio-h-10-dtau-0.02.PNG}
        \subcaption{$h = 10$}
    \end{subfigure}
    \caption{$J_{xy} / J_\tau$ under different $h$. 
    It can be seen that \eqref{eq:cim-from-tfim} is highly anisotropic for a large range of $J$. The diagrams are plotted using \href{../analytical/jxy-jtau-ratio/2d-tfim-to-3d-cim-v2.jl}{this script}. }
    \label{fig:jxy-jtau-ratio}
\end{figure}

In this section we use $\sigma$ to denote spin-$1/2$ degrees of freedom in a 2D \tfim.
This notation conflicts with the symbol $\sigma$ for \Ztwo gauge field, 
and is inconsistent with the symbol $s$ for the Ising field, 
but since we do not deal with the complete \eqref{eq:proposed-model} it does not matter.
We also let $\sigma^z = \{\sigma^z_{\vb*{i}}(\tau)\}$ be the field configuration at $\tau$.

The \tfim{} is 
\begin{equation}
    H_\text{TFIM} = - J \sum_{\pair{\vb*{i}, \vb*{j}}} \sigma^z_{\vb*{i}} \sigma^z_{\vb*{j}} + h \sum_{\vb*{i}} \sigma^x_{\vb*{i}}.
    \label{eq:tfim-hamiltonian}
\end{equation}
We know that a two dimensional quantum statistical model corresponds to a three dimensional classical statistical model, which is because a quantum statistical model can have quantum fluctuation and therefore imaginary time evolution, adding one imaginary time dimension.
It is, therefore, a wise idea to write down the discrete path integral formulation of \eqref{eq:tfim-hamiltonian}, and use the Metropolis algorithm to simulate the discrete path integral, which is a 2+1 dimensional model.

An imaginary time step in the path integral of \eqref{eq:tfim-hamiltonian} is 

\[
    \begin{aligned}
        \mel{\sigma^z(\tau + \Delta \tau)}{\ee^{-\Delta \tau {H}}}{\sigma^z(\tau)} &= \mel{\sigma^z(\tau + \Delta \tau)}{\ee^{- \Delta \tau \sum_{\vb*{i}} h {\sigma}^x_{\vb*{i}}} \ee^{\Delta \tau \sum_{\pair{\vb*{i}, \vb*{j}}} J {\sigma}_{\vb*{i}}^z {\sigma}_{\vb*{j}}^z}}{\sigma^z(\tau)} \\
        &= \ee^{\Delta \tau \sum_{\pair{\vb*{i}, \vb*{j}}} J \sigma_{\vb*{i}}^z \sigma_{\vb*{j}}^z} \mel{\sigma^z(\tau + \Delta \tau)}{\ee^{- \Delta \tau \sum_{\vb*{i}} h {\sigma}^x_{\vb*{i}}}}{\sigma^z(\tau)} \\
        &= \ee^{\Delta \tau \sum_{\pair{\vb*{i}, \vb*{j}}} J \sigma_{\vb*{i}}^z \sigma_{\vb*{j}}^z} \sum_{\{\sigma^x_{\vb*{i}}\}} \ee^{- \Delta \tau \sum_{\vb*{i}} h \sigma^x_{\vb*{i}}} \braket{\sigma^z(\tau + \Delta \tau)}{\sigma^x} \braket{\sigma^x}{\sigma^z(\tau)} \\
        &= \ee^{\Delta \tau \sum_{\pair{\vb*{i}, \vb*{j}}} J \sigma_{\vb*{i}}^z \sigma_{\vb*{j}}^z} \prod_{\vb*{i}} \sum_{\sigma^x_{\vb*{i}}} \ee^{- \Delta \tau h \sigma^x_{\vb*{i}}} \braket{\sigma^z_{\vb*{i}}(\tau + \Delta \tau)}{\sigma^x_{\vb*{i}}} \braket{\sigma^x_{\vb*{i}}}{\sigma^z_{\vb*{i}}(\tau)} \\
        &= \ee^{\Delta \tau \sum_{\pair{\vb*{i}, \vb*{j}}} J \sigma_{\vb*{i}}^z \sigma_{\vb*{j}}^z} \prod_{\vb*{i}} \sum_{\sigma^x_{\vb*{i}} = \pm 1} \ee^{- \Delta \tau h \sigma^x_{\vb*{i}}} \frac{1}{2} \ee^{\ii \pi \frac{1 - \sigma^x_{\vb*{i}}}{2} \left( \frac{1 - \sigma^z_{\vb*{i}}(\tau)}{2} + \frac{1 - \sigma^z_{\vb*{i}}(\tau + \Delta \tau)}{2} \right)} \\
        &= \frac{1}{2^N} \ee^{\Delta \tau \sum_{\pair{\vb*{i}, \vb*{j}}} J \sigma_{\vb*{i}}^z \sigma_{\vb*{j}}^z} \prod_{\vb*{i}} \left( \ee^{- \Delta \tau h} + \ee^{\Delta \tau h} \ee^{\ii \pi \frac{1 - \sigma^z_{\vb*{i}}(\tau)}{2}} \ee^{\ii \pi \frac{1 - \sigma^z_{\vb*{i}}(\tau + \Delta \tau)}{2}} \right) \\
        &= \frac{1}{2^N} \ee^{\Delta \tau \sum_{\pair{\vb*{i}, \vb*{j}}} J \sigma_{\vb*{i}}^z \sigma_{\vb*{j}}^z} \prod_{\vb*{i}} \left( \ee^{- \Delta \tau h} + \ee^{\Delta \tau h} \sigma^z_{\vb*{i}}(\tau) \sigma^z_{\vb*{i}}(\tau + \Delta \tau) \right).
    \end{aligned}
\]
The first equation introduces a Trotter error with magnitude $\bigO(\Delta \tau^2)$.
Since $\sigma_{\vb*{i}}^z = \pm 1$, we have
\[
    \cosh J_\tau + \sinh J_\tau \sigma^z_{\vb*{i}}(\tau) \sigma^z_{\vb*{i}}(\tau + \Delta \tau) = \ee^{J_\tau \sigma^z_{\vb*{i}}(\tau) \sigma^z_{\vb*{i}}(\tau + \Delta \tau)},
\]
so 
\[
    \ee^{- \Delta \tau h} + \ee^{\Delta \tau h} \sigma^z_{\vb*{i}}(\tau) \sigma^z_{\vb*{i}}(\tau + \Delta \tau) \propto \ee^{J_\tau \sigma^z_{\vb*{i}}(\tau) \sigma^z_{\vb*{i}}(\tau + \Delta \tau)},
\]
where
\[
    \tanh J_\tau = \ee^{2 \Delta \tau h}.
\]
So the discrete path integral of \eqref{eq:tfim-hamiltonian} with time step $\Delta \tau$ shares its weights with the partition function of the \cim
\begin{equation}
    H = - J_{xy} \sum_{\tau, \text{ spacial $\pair{\vb*{i}, \vb*{j}}$}} \sigma_{\vb*{i} \tau} \sigma_{\vb*{j} \tau} - J_\tau \sum_{\tau, \vb*{i}} \sigma_{\vb*{i} \tau} \sigma_{\vb*{i}, \tau + \Delta \tau}
    \label{eq:cim-from-tfim} 
\end{equation}
at $T = 1$, where
\begin{equation}
    J_{xy} = \Delta \tau J, \quad \tanh J_\tau = \ee^{2 \Delta \tau h}.
\end{equation}

\begin{figure}
    \centering
    \includegraphics[width=0.55\textwidth]{../analytical/jxy-jtau-ratio/ratio-h-10-extreme-range.PNG}
    \caption{$\log(J_{xy} / J_\tau)$ with extremely large $\Delta \tau$}
    \label{fig:extreme-tau}
\end{figure}

To ensure high accuracy, we have to use a $\Delta \tau$ small enough, especially for a large $h$, or otherwise we will have large Trotter error.
From \prettyref{fig:jxy-jtau-ratio} we can see that when $\Delta \tau$ is large, the contours are more horizontal, or in other words, the change of $J$ may not be reflected faithfully to the change of $J_{xy} / J_\tau$.
Since the discrete path integral will be studied as a classical Ising model \eqref{eq:cim-from-tfim} under a fixed temperature, the system is characterized by $J_{xy} / J_\tau$, and if $J_{xy} / J_\tau$ does not reflect the properties of the transverse field Ising model faithfully the Monte Carlo simulation of \eqref{eq:cim-from-tfim} does not make any sense.
An extreme case can be found in \prettyref{fig:extreme-tau}, where the contours are almost completely horizontal.

% TODO: are these claims true?
%Another fact that can be read from \prettyref{fig:jxy-jtau-ratio} is that for large $h / K$ $\Delta \tau$ should be smaller to keep the same accuracy.
%The larger $h$ is, the stronger the quantum fluctuation is, 
%and with strong quantum fluctuation $\Delta \tau$ must be small enough to accurately track the time evolution.

It should be noted, however, that \eqref{eq:cim-from-tfim} is usually highly anisotropic between time and space, so when $\Delta \tau$ goes too small, the model is hard to simulate with Metropolis algorithm.

\subsubsection{Cluster update algorithm along the temporal direction}

The anisotropic feature of \eqref{eq:cim-from-tfim} is tackled in \cite{Blte2002}.

We did a benchmark of our algorithm with data provided in \cite{Friedman_1978}.

\subsubsection{Worm algorithm for 2D \tfim{}}

Another way to simulate 2D \tfim{} is described in \cite{Huang_2020}.
We do the following (canonical) substitution
\begin{equation}
    \sigma_{\vb*{i}}^x \longrightarrow - \sigma^z_{\vb*{i}}, \quad \sigma_{\vb*{i}}^z \longrightarrow - \sigma^x_{\vb*{i}}, \quad \sigma^y_{\vb*{i}} \longrightarrow - \sigma^y_{\vb*{i}}
\end{equation}
in \eqref{eq:tfim-hamiltonian}, and obtain
\begin{equation}
    H = - J \sum_{\pair{\vb*{i}, \vb*{j}}} \sigma^x_{\vb*{i}} \sigma^x_{\vb*{j}} - h \sum_{\vb*{i}} \sigma^z_{\vb*{i}}.
    \label{eq:tfim-string-form}
\end{equation}
which can be viewed as a string-net model, where the $\sum \sigma^z$ term is string tension term and the other term is the string kinetic term.
The ends of a $\sigma^z$ string are two sites on which $\sigma^z = -1$, as opposed to the ``vacuum'' case where $\sigma^z = 1$.
We define the ladder operators in the standard way
\begin{equation}
    \sigma^\pm_{\vb*{i}} = \frac{\sigma^x_{\vb*{i}} \pm \ii \sigma^y_{\vb*{i}}}{2},
\end{equation}
then \eqref{eq:tfim-string-form} turns into
\begin{equation}
    H = - J \sum_{\pair{\vb*{i}, \vb*{j}}} (\sigma^+_{\vb*{i}} \sigma^-_{\vb*{j}} + \sigma^+_{\vb*{i}} \sigma^+_{\vb*{j}} + \text{h.c.}) - h \sum_{\vb*{i}} \sigma_{\vb*{i}}^z,
    \label{eq:tfim-string-fragments}
\end{equation}
which can also be rewrite into one of hardcore boson model.

\begin{figure}
    \centering
    \begin{subfigure}{0.48\textwidth}
        \input{lattice/string-creation.tex}
        \subcaption{}
    \end{subfigure}
    \begin{subfigure}{0.48\textwidth}
        \input{lattice/string-move.tex}
        \subcaption{}
    \end{subfigure}
    \caption{String fragments provided in \eqref{eq:tfim-string-fragments}. 
    (a) corresponds to the $\sigma^+ \sigma^+$ term, where a minimal string is created out of nothing, 
    or in other words, two magnons are created out of nothing.
    (b) corresponds to the $\sigma^+ \sigma^-$ term, which extends an existing string, 
    or in other words, a magnon is moved to its nearest neighbor. 
    The time inverse of (a) and (b) can be easily found, which are annihilation of a minimal string and shortening an existing string, correspondingly.}
    \label{fig:tfim-string-fragments}
\end{figure}

The $\sigma^z$ strings can expand and shrink, and their ends can hop from one site to its neighbors, 
according to the first four terms in the Hamiltonian, which are factories of string fragments.
This is visualize in \prettyref{fig:tfim-string-fragments}.
It should be noted that the $\sigma^+ \sigma^+$ term only applies to vacuum, or otherwise it just returns zero.
Likewise, the $\sigma^+ \sigma^-$ term only applies to existing strings, or otherwise it just returns zero.
Two or more minimal strings can be created at the same time, 
so effectively, a prolonged string can be generated from vacuum in just one time step.
As a result, the field configuration used in the path integral is something like this: 
a string is created, and then distorted, and finally annihilated.
So each field configuration used in the path integral is a set of \emph{closed} strings or loops, 
which are just \emph{world lines} of magnons, as is depicted in \prettyref{fig:tfim-worldline}.
We name the $\sigma^+ \sigma^+ + \text{h.c.}$ terms as \concept{pairing}, the $\sigma^+ \sigma^- + \text{h.c.}$ terms \concept{hopping}.

\begin{figure}
    \centering
    \input{lattice/worldline.tex}
    \caption{World lines of magnons in a \tfim{} model, under the periodic boundary condition. Note that a loop can go across the boundary.}
    \label{fig:tfim-worldline}
\end{figure}

Now we write down the partition function in the path integral form.
Suppose there are $m$ time steps. The discrete path integral is 
\begin{equation}
    Z = \sum_{\{\sigma_\tau\}} \mel{\sigma_0}{\ee^{-\Delta \tau H}}{\sigma_\beta} \cdots \mel{\sigma_{2\Delta \tau}}{\ee^{-\Delta \tau H}}{\sigma_{\Delta \tau}} \mel{\sigma_{\Delta \tau}}{\ee^{-\Delta \tau H}}{\sigma_{0}}  
\end{equation}
where $\sigma_\tau$ is an arbitrary configuration in the $\sigma^z$ basis.
We classify $\{\sigma_\tau\}$ first according to the number of pairing and hopping, and denote them as $N_\text{p}$ and $N_\text{h}$, respectively.
The weight of a field configuration with $N_\text{p}$ pairing fragments and $N_\text{h}$ hopping fragments is
\[
    \mel{\sigma_0}{\ee^{-\Delta \tau H}}{\sigma_\beta} \cdots \mel{\sigma_{2\Delta \tau}}{\ee^{-\Delta \tau H}}{\sigma_{\Delta \tau}} \mel{\sigma_{\Delta \tau}}{\ee^{-\Delta \tau H}}{\sigma_{0}} = 
\]

\subsection{The \Ztwo gauge theory}

\subsubsection{Dual transverse Ising model}

It is possible to simulate the \Ztwo gauge theory via simulating its dual \tfim.
It should be pointed out that removing gauge redundancy will generally make a gauge theory with matter fields non-local.
In out case, when the \Ztwo gauge theory is rephrased into a \tfim, the coupling term between $\sigma^z$ and deconfined fermions will involve a string operator.

Therefore, we will mostly focus on simulating the \Ztwo gauge theory as it is, and only use the dual \tfim model as a benchmark.

\subsubsection{Simulating \Ztwo gauge theory as it is: discrete path integral of \Ztwo guage theory}

Similar to the case in 2D \tfim{}, we may use a discrete path integral to turn the \Ztwo gauge theory \eqref{eq:standard-z2-theory} into a classical statistical model.
With the presence of $H_h$, the $H_Z$ factor of each imaginary time step reads
\[
    \begin{aligned}
        &\quad \mel{\sigma(\tau + \Delta \tau)}{\ee^{-\Delta \tau H_{Z0}} \ee^{-\Delta \tau H_h}}{\sigma(\tau)} \\ 
        &= \ee^{-\Delta \tau H_{Z0}|_{\sigma(\tau)}} \sum_{\sigma^x} \ee^{-\Delta \tau H_h|_{\sigma^x}} \braket{\sigma^z(\tau+\Delta \tau)}{\sigma^x} \braket{\sigma^x}{\sigma^z(\tau)} \\
        &= \ee^{-\Delta \tau H_{Z0}|_{\sigma(\tau)}} \sum_{\sigma^x} \ee^{h \Delta \tau \sum_{\pair{\vb*{i}, \vb*{j}}} \sigma^x_{\vb*{i} \vb*{j}}} \braket{\sigma^z(\tau+\Delta \tau)}{\sigma^x} \braket{\sigma^x}{\sigma^z(\tau)} \\
        &= \ee^{-\Delta \tau H_{Z0}|_{\sigma(\tau)}} \prod_{\text{bond } l} \sum_{\sigma^x_l =\pm 1} \ee^{h \Delta \tau \sigma^x_l} \braket{\sigma^z_l(\tau+\Delta \tau)}{\sigma^x_l} \braket{\sigma^x_l}{\sigma^z_l(\tau)} \\
        &= \ee^{-\Delta \tau H_{Z0}|_{\sigma(\tau)}} \prod_{\text{bond } l} \sum_{\sigma^x_l =\pm 1} \ee^{h \Delta \tau \sigma^x_l} \braket{\sigma^z_l(\tau+\Delta \tau)}{\sigma^x_l} \braket{\sigma^x_l}{\sigma^z_l(\tau)}.
    \end{aligned}
\]
By the formula
\[
    \braket{\sigma^x_l}{\sigma^z_l(\tau)} = \frac{1}{\sqrt{2}} \ee^{\ii \pi \frac{1 - \sigma^x_l}{2} \frac{1 - \sigma^z_l(\tau)}{2}} ,
\]
we have
\[
    \begin{aligned}
        &\quad \mel{\sigma(\tau + \Delta \tau)}{\ee^{-\Delta \tau H_{Z0}} \ee^{-\Delta \tau H_h}}{\sigma(\tau)} \\
        &= \ee^{-\Delta \tau H_{Z0}|_{\sigma(\tau)}} \prod_{\text{bond } l} \sum_{\sigma^x_l =\pm 1} \ee^{h \Delta \tau \sigma^x_l} \frac{1}{2} \ee^{\ii \pi \frac{1 - \sigma^x_l}{2} \frac{1 - \sigma^z_l(\tau)}{2}} \ee^{\ii \pi  \frac{1 - \sigma^x_l}{2} \frac{1 - \sigma^z_l(\tau + \Delta \tau)}{2}} \\
        &= \frac{1}{2^{2N}} \ee^{-\Delta \tau H_{Z0}|_{\sigma(\tau)}} \prod_{\text{bond } l} \left( \ee^{h \Delta \tau} + \ee^{- h \Delta \tau} \ee^{\ii \pi (\frac{1 - \sigma^z_l(\tau)}{2} + \frac{1 - \sigma^z_l(\tau + \Delta \tau)}{2})} \right) \\
        &= \frac{1}{2^{2N}} \ee^{-\Delta \tau H_{Z0}|_{\sigma(\tau)}} \prod_{\text{bond } l} \left( \ee^{h \Delta \tau} + \ee^{- h \Delta \tau} \sigma_l^z(\tau) \sigma_l^z(\tau + \Delta \tau) \right) \\
        &= \frac{1}{2^{2N}} \ee^{-\Delta \tau H_{Z0}|_{\sigma(\tau)}} \prod_{\text{bond } l} \ee^{J_\tau \sigma_l^z(\tau) \sigma_l^z(\tau + \Delta \tau)}.
    \end{aligned}
\]
where 
\begin{equation}
    \tanh J_\tau = \ee^{-2 h \Delta \tau}.
\end{equation}
The last few steps all use the fact that $\sigma^z_l = \pm 1$.
So we just need to simulate the ``classical \Ztwo gauge theory''
\begin{equation}
    H = - \Delta \tau J \sum_{\vb*{i}, \tau} \prod_{\vb*{l} \in \Box_{\vb*{i}^*}} \sigma_{\vb*{l}}(\tau) 
    - J_\tau \sum_{\text{bond $\vb*{l}$}, \tau} \sigma_l^z(\tau) \sigma_l^z(\tau + \Delta \tau)
    \label{eq:classical-z2-theory}
\end{equation}
at $T = 1$. \eqref{eq:classical-z2-theory} actually does not have a \Ztwo gauge symmetry, as it can be seen as a 2+1 dimensional \Ztwo theory in the path integral formalism with gauge choice
\begin{equation}
    \sigma_{\vb*{i}, \pair{\tau, \tau + \Delta \tau}} = 1,
\end{equation}
shown in \prettyref{fig:temporal-gauge}.
This fact actually explains in an intuitively way why \eqref{eq:gauge-choice-x} does not work:
by introducing a transverse field (or string tension term), we have already done an implicit gauge fixing with the form $\sigma=\cdots$, and it is generally impossible to do another like \eqref{eq:gauge-choice-x}.

\begin{figure}
    \centering
    \input{lattice/temporal-gauge.tex}
    \caption{The temporal gauge: the red and blue spin degrees of freedom can rotate arbitrarily, while the black ones (which are on bonds with temporal directions) are fixed to 1. }
    \label{fig:temporal-gauge}
\end{figure}

\subsection{Fermion coupling}

\concept{Determinant Quantum Monte Carlo (DQMC)} is a discrete path integral for fermions, 
where an (bosonic) auxiliary field is introduced by Hubbard-Stratonovich transformation and Green functions of the fermions can be recast in terms of the auxiliary field, so we rephrase a fermionic problem into a bosonic one.

The way to simulate fermions coupled to an Ising field with a coupling Hamiltonian in the form of 
\begin{equation}
    H \propto \sum_{\pair{\vb*{i}, \vb*{j}}} S_{\vb*{i}}^z S_{\vb*{j}}^z c^\dagger_{\vb*{i}} c_{\vb*{j}}
\end{equation}
can be found in the appendix of \cite{Chen_2021}. 

\subsubsection{DQMC for fermion-gauge field coupling in \eqref{eq:proposed-model}}   

DQMC for \eqref{eq:proposed-model} is kind of different from the usual DQMC for interacting fermion systems, because here deconfined fermions do not have direct interaction.
We can directly integrate out the fermionic degrees of freedom and obtain a discrete path integral for only the \Ztwo gauge field and the Ising field.
For example, we introduce a Trotter decomposition with imaginary time step $\Delta \tau = \beta / m$, choose $\sigma_{\vb*{i} \vb*{j}}, s_{\vb*{i}}$ as labels for the \Ztwo field and the Ising field, respectively, and integrate out the fermion hopping term. 
Now a configuration of the systems is a sequence of length $m$, and at each imaginary time point $\tau$ there is a \Ztwo field $\sigma_{\vb*{i} \vb*{j}}(\tau)$ and an Ising field $s_{\vb*{i} \vb*{j}}(\tau)$.
The weight of a configuration is 
\begin{equation}
    \begin{aligned}
        &\quad W(\sigma, s) \\
        &= \trace_\text{fermion} \prod_{\tau = 1}^{m\Delta \tau} \mel{(\sigma, s)(\tau+\Delta \tau)}{\ee^{-\Delta \tau H_Z} \ee^{- \Delta \tau H_\text{Ising}}}{(\sigma, s)(\tau)} \ee^{\Delta \tau t \sum_{\pair{\vb*{i}, \vb*{j}}} \sigma_{\vb*{i} \vb*{j}}(\tau) c_i^\dagger c_{\vb*{j}}} \\
        &= \det \left(1 + \prod_{\tau = 1}^{m\Delta \tau} \ee^{\Delta \tau t \bm{\sigma}(\tau)}\right) \prod_{\tau = 1}^{m\Delta \tau} \mel{(\sigma, s)(\tau+\Delta \tau)}{\ee^{-\Delta \tau H_Z} \ee^{- \Delta \tau H_\text{Ising}}}{(\sigma, s)(\tau)} \\
        &= \det \left(1 + \prod_{\tau = 1}^{m\Delta \tau} \ee^{\Delta \tau t \bm{\sigma}(\tau)}\right) \prod_{\tau = 1}^{m\Delta \tau} \mel{\sigma(\tau + \Delta \tau)}{\ee^{-\Delta \tau H_Z}}{\sigma(\tau)} \mel{s(\tau + \Delta \tau)}{\ee^{-\Delta \tau H_\text{Ising}|_{\sigma(\tau)}}}{s(\tau)} ,
    \end{aligned}
\end{equation}
where $\bm{\sigma} = \{\sigma_{\vb*{i} \vb*{j}}(\tau)\}$ and $s = \{s_{\vb*{i}}(\tau)\}$, 
and in the last line values of $\sigma(\tau)$ replaces the $\sigma^z$ operators in $H_\text{Ising}$.
We can see that the \Ztwo part and the \tfim{} part now has nothing to do with the fermions - as is the case in ordinary continuous path integrals - and can be simulated either natively by considering the path integral as a classical statistical model to be calculated with the Metropolis algorithm or maybe some cluster update algorithms, or by more sophisticated algorithms like the SSE.
As for the factor containing the product of $\ee^{\Delta\tau t \bm{\sigma}(\tau)}$, i.e. 
\begin{equation}
    W_\text{fermion}(\sigma) = \det \left(1 + \prod_{\tau = 1}^{m\Delta \tau} \vb{B}_\tau \right), \quad \vb{B}_\tau =  \ee^{\Delta \tau t \bm{\sigma}(\tau)},
\end{equation}
we find their effective calculation is very hard and should better be updated using DQMC, and here the \Ztwo gauge theory $\sigma_{\vb*{i} \vb*{j}}(\tau)$ plays the role of the auxiliary field.
We define 
\begin{equation}
    \begin{gathered}
        \mathbf{B}_{m} \cdots \mathbf{B}_{\tau+1} \eqqcolon \mathbf{B}(\beta, \tau), \\
        \mathbf{B}_{\tau} \cdots \mathbf{B}_{1} \eqqcolon \mathbf{B}(\tau, 0),
    \end{gathered}
\end{equation}
and the acceptance rate can be calculated as 
\begin{equation}
    \begin{aligned}
        & \frac{\operatorname{det}(1+\mathbf{B}(\beta, \tau)(1+\vb{\Delta})(\mathbf{B}(\tau, 0))}{\operatorname{det}(1+\mathbf{B}(\beta, \tau) \mathbf{B}(\tau, 0))} \\
        =& \operatorname{det}\left(1+\vb{\Delta}\left(1-(1+\mathbf{B}(\tau, 0) \mathbf{B}(\beta, \tau))^{-1}\right)\right) \\
        =& \operatorname{det}(1+\vb{\Delta}(1-\mathbf{G}(\tau, \tau))),
    \end{aligned}
\end{equation}
where the Green function is 
\begin{equation}
    \mathbf{G}(\tau, \tau) = (1+\mathbf{B}(\tau, 0) \mathbf{B}(\beta, \tau))^{-1}.
    \label{eq:green-function-def}
\end{equation}

Now we derive explicitly $\vb{\Delta}$ matrices needed for updating. We have
\[
    \begin{aligned}
        &\quad \exp(\Delta\tau t \pmqty{
        \ddots & \vdots & & \vdots & \iddots \\
        \cdots & 0 & \cdots & - \sigma^z_{\vb*{i} \vb*{j}}(\tau) & \cdots \\ 
         & \vdots & & \vdots & \\
        \cdots & - \sigma^z_{\vb*{i} \vb*{j}}(\tau) & \cdots & 0 & \cdots \\
        \iddots & \vdots & & \vdots & \ddots
        }) \\
        &= (\vb{I} + \vb{\Delta})  \exp(\Delta\tau t \pmqty{
        \ddots & \vdots & & \vdots & \iddots \\
        \cdots & 0 & \cdots & \sigma^z_{\vb*{i} \vb*{j}}(\tau) & \cdots \\ 
         & \vdots & & \vdots & \\
        \cdots & \sigma^z_{\vb*{i} \vb*{j}}(\tau) & \cdots & 0 & \cdots \\
        \iddots & \vdots & & \vdots & \ddots
        }) ,
    \end{aligned}
\]
and therefore we have 
\[
    \vb{\Delta} = \exp\pmqty{\dmat{\vb{1}, -2 \Delta \tau t \sigma^x , \vb{1}}} - \vb{I},
\]
where the indices of the $\sigma^x$ block spans from $\vb*{i}$ to $\vb*{j}$.
Note that 
\[
    \exp(\alpha \sigma^x) = \sigma^0 \cosh \alpha + \sigma^x \sinh \alpha,
\]
we obtain the projection of $\vb{\Delta}$ on the subspace of $\vb*{i}$ and $\vb*{j}$, which is 
\begin{equation}
    \vb{\Delta} = \pmqty{ \cosh(2 \Delta \tau t \sigma_{\vb*{i} \vb*{j}}^z(\tau))-1 & - \sinh(2 \Delta \tau t \sigma_{\vb*{i} \vb*{j}}^z(\tau)) \\
    - \sinh(2 \Delta \tau t \sigma_{\vb*{i} \vb*{j}}^z(\tau)) & \cosh(2 \Delta \tau t \sigma_{\vb*{i} \vb*{j}}^z(\tau)) - 1}.
\end{equation}
All other elements of $\vb{\Delta}$ are zero.

\subsubsection{An overview of subroutines} 

Now we divide the calculation above into subroutines. They are:
\begin{itemize}
    \item Calculating $\vb{B}_\tau$ at a time step from the auxiliary field configuration, 
    \item Calculating $\vb{B}(\tau, 0)$ and $\vb{B}(\beta, \tau)$ from $\vb{B}_\tau$,
    \item Calculating equal time Green functions from $\vb{B}(\beta, \tau)$ and $\vb{B}(\tau, 0)$,
    \item Calculating accept rate from Green functions, and
    \item Update Green function, i.e. calculating Green function after updating from the Green function before 
    updating.
\end{itemize} 
Note that among these procedures, the Green function update routine has accumulated numerical error, 
and therefore from time to time, we have to recalculate Green functions directly from $\vb{B}$ matrices. 
This is often called ``numerical stabilization'', because with this re-calculation step the numerical error 
in matrix production is controlled. Note that \eqref{eq:green-function-def} involves inversion of a matrix 
with both large and small energy scales, we need some numerical trick to calculate it accurately.
We have 
\begin{equation}
    \begin{aligned}
        &\quad \mathbf{G}(\tau, \tau) \\
        &=[1+\mathbf{B}(\tau, 0) \mathbf{B}(\beta, \tau)]^{-1} \\
        &=\left[1+\mathbf{U}_{R} \mathbf{D}_{R} \mathbf{V}_{R} \mathbf{V}_{L} \mathbf{D}_{L} \mathbf{U}_{L}\right]^{-1} \\
        &=\mathbf{U}_{L}^{-1}\left[\left(\mathbf{U}_{L} \mathbf{U}_{R}\right)^{-1}+\mathbf{D}_{R}\left(\mathbf{V}_{R} \mathbf{V}_{L}\right) \mathbf{D}_{L}\right]^{-1} \mathbf{U}_{R}^{-1} \\
        &=\mathbf{U}_{L}^{-1}\left[\left(\mathbf{U}_{L} \mathbf{U}_{R}\right)^{-1}+\mathbf{D}_{R}^{\max } \mathbf{D}_{R}^{\min }\left(\mathbf{V}_{R} \mathbf{V}_{L}\right) \mathbf{D}_{L}^{\min } \mathbf{D}_{L}^{\max }\right]^{-1} \mathbf{U}_{R}^{-1} \\
        &=\mathbf{U}_{L}^{-1}\left(\mathbf{D}_{L}^{\max }\right)^{-1}\left[\left(\mathbf{D}_{R}^{\max }\right)^{-1}\left(\mathbf{U}_{L} \mathbf{U}_{R}\right)^{-1}\left(\mathbf{D}_{L}^{\max }\right)^{-1}+\mathbf{D}_{R}^{\min } \mathbf{V}_{R} \mathbf{V}_{L} \mathbf{D}_{L}^{\min }\right]^{-1}\left(\mathbf{D}_{R}^{\max }\right)^{-1} \mathbf{U}_{R}^{-1},
        \end{aligned}
        \label{eq:green-udv}
\end{equation}
where $\vb{D}$ is obtained via SVD decomposition and is a diagonal matrix, and therefore, suppose
$\vb{D}^\text{max}$ is obtained by setting all elements in $\vb{D}$ that are smaller than $\lambda$
into unity, and $\vb{D}^\text{min}$ is obtained by setting all elements in $\vb{D}$ that are larger 
than $\lambda$ into unity, where $\lambda \simeq 1$, then we have 
\[
    \vb{D} = \vb{D}^\text{max} \vb{D}^\text{min} = \vb{D}^\text{min} \vb{D}^\text{max},
\]
and we see the last line of \eqref{eq:green-udv} does not involve inversion of a matrix with small eigenvalues,
so there is no large numerical error in \eqref{eq:green-udv}.

The fact that we are going to use \eqref{eq:green-udv} to calculate Green functions means we have to decompose
$\vb{B}$ matrices into $U, D, V$ before calculating Green functions. The decomposition is implemented using 
SVD decomposition which is provided in every linear algebra library. The decomposition procedure is often called 
as 

\begin{algorithm}

    \DontPrintSemicolon
    \SetAlgoLined

    \SetKwFunction{dqmcsweep}{dqmc\_sweep}
    \Function(\tcc*[h]{Perform a complete sweep, from $\tau=1$ to $\tau=\beta$ and then back}){\dqmcsweep{i}}{
        \eIf{Condition}{Then}{else}

    \For(\tcc*[h]{for condition comment}){for condition}{
        Do sth \tcc*[r]{asdf}
    }

    \While{the condition}{
        do something \;
        $i = i + 1$ \;
        
    }
    
    \Return{return value}\;
    \Begin{Mad}
    }

    \caption{Procedures used in DQMC}
    \label{alg:procedures}
\end{algorithm}

\subsubsection{Error analysis}

Trotter errors are largely ignored in this project. Nor will we perform a systematic analysis to see whether the Trotter errors are bounded.
This is actually reasonable because terms and parameters in \eqref{eq:proposed-model} are \emph{not} based on any \emph{ab initio} results, and the universality of \eqref{eq:proposed-model} is more important than its quantitative behaviors.
Usually, Trotter errors do not change the universality class, so we will be willing to forget about them.
When we do have to simulate the behaviors of \eqref{eq:proposed-model} quantitative, we can always do the computation with different $\Delta \tau$ choices and plot the observables to see the $\Delta \tau \to 0$ limit.

Some Monte Carlo flavors other than out discrete path integral approach - for example, the SSE - do not have the problem of Trotter errors, but there are other errors that are hard to keep track of.
The maximum order of terms in the SSE, for example, largely determine the precision, and within the framework of the SSE we have to do observables v.s. expansion order plotting and extrapolation.

\section{Details of the program}

Among different numerical approaches in computational condensed matter physics, 
quantum Monte Carlo programs may be the closest to the standard procedural programming paradigm:
Data is entered, and then some processes happen, and then an output is generated.
No reusable components, and no compositionality.
That may be the reason why many people still use Fortran to implement quantum Monte Carlo algorithms even today,
because no high-level feature is really required.

That being said, in this project we still try to make the code generic for several reasons.
One reason is to avoid rewriting over and over again when faced with new models. 
For example, defining \tfim{} and the Ising gauge theory on an arbitrary lattice can reduce our burden to have one program version for the square lattice and another version for the honeycomb lattice.
Another reason is to make benchmarking easier. 
We know unfolding concise codes involving linear algebra, array comprehension, etc. into lines can save a large amount of memory allocation time,
but the cole after the expansion is hard to read and analyze.
In this case, generic definitions can be used as a correct-yet-slow benchmark for the expanded version, which agrees with Julia's design philosophy.

\subsection{List of abbreviations}

\paragraph{DPI} discrete path integral
\paragraph{DQMC} determinant quantum Monte Carlo

\subsection{The lattice}

\begin{figure}
    \input{lattice/lattice-representation.tex}
    \caption{How the lattice is represented in the program. 
    The black numbers placed on sites are the indices of the sites.
    The red and blue numbers placed on bonds are the indices of the bonds. The bonds form a centered square lattice, and the red numbers correspond to bonds in the A sublattice, the blue numbers the B sublattice.
    The grey numbers placed on the center of each plaquette is the index of the plaquette.
    Sites in the gray square box are actually stored, while sites out of the gray square box are illustrated to visualize the periodic boundary condition.}
    \label{fig:label-representation}
\end{figure}

How the lattice is represented in our program can be found in \prettyref{fig:label-representation}.
We assign one index to each sites in the 2D periodic lattice.
The index agrees with the default column-major order in Julia arrays, if we regard $x$ as the first index and $y$ as the second index of an array, and regard the sites in the lattice as the placeholders of elements in a stringified matrix.

The bonds of the lattice themselves form another lattice, which is a centered square lattice.

The fact that the lattice is periodic is reflected by the fact that, for example, there is a bond between site 4 and site 1, indexed as 20, the coordinate of which in the lattice formed by bonds is $(4, \text{B})$ or $(4, 1, \text{B})$.
Note that in the expression $(4, 1, \text{B})$, $1$ is the $y$ coordinate instead of the label of site 1.

All plaquettes form a dual lattice, the shape and size of which is exact the same as the lattice shown in the figure.
A plaquette shares its index with the top left site, 
which agrees with \prettyref{fig:z2-gauge-field} (note that the two figures' coordinate systems differ in a rotation).

The bonds can be enumerated using a trick called the \emph{check-board decomposition}, 
where half of the plaquettes are picked out
(in \prettyref{fig:label-representation} these plaquettes are painted in green and yellow), 
the bonds of which are disjoint with each other.
For example, plaquette~1 has four bonds, namely bond~1, bond~2, bond~17 and bond~21.
These bonds will not be seen in any other bonds colored as green or yellow.
On the other hand, if we have $N$ sites, the number of selected plaquettes is $N/2$, 
and hence the number of bonds attached to the selected plaquettes is $N/2 \times 4$, which is exactly the number of all bonds.
The check-board decomposition is useful because it can be noted that if a part of the Hamiltonian is defined as the sum of some operators defined on plaquettes, 
then operators defined on the green plaquettes commute with each other, and so do the operators defined on yellow plaquettes.
An operator defined on the green plaquette does not necessarily commute with an operator defined on the yellow plaquette,
so we have 
\begin{equation}
    \begin{aligned}
        \ee^{-\Delta \tau \sum_{\Box_{\vb*{i}}} O_{\vb*{i}}} &\approx \ee^{- \Delta \tau \sum_{\Box_{\vb*{i}} \in \mathrm{fam}_1} O_{\vb*{i}}} \ee^{- \Delta \tau \tau \sum_{\Box_{\vb*{i}} \in \mathrm{fam}_2} O_{\vb*{i}}}  \\
        &= \prod_{\Box_{\vb*{i}} \in \mathrm{fam}_1} \ee^{- \Delta \tau O_{\vb*{i}}} \prod_{\Box_{\vb*{i}} \ee^{- \Delta \tau \tau \in \mathrm{fam}_2} O_{\vb*{i}}} \ee^{- \Delta \tau O_{\vb*{i}}}.
    \end{aligned}
\end{equation}
There is still Trotter error, but it only comes from the first step, and as long as $\Delta \tau$ is small enough to make the first equation a reasonable approximation, we can move multiplicative factors in the second equation without introducing additional error.
The check-board decomposition, therefore, is a useful method to reduce the Trotter error without having to accept a too small $\Delta \tau$.

\subsection{Storage of fields}

\subsubsection{The \Ztwo gauge field}

\begin{figure}
    \centering
    \input{lattice/gauge-sublattice.tex}
    \caption{Dividing a gauge field configuration into two sublattices}
    \label{fig:z2-dividing}
\end{figure}

\Ztwo gauge degrees of freedom are defined on bonds. 
Suppose there are $N$ sites. Since there are 4 bonds connecting to one site and a bond is shared by two sites,
there are $4 N / 2 = 2 N$ bonds.
Therefore, the \Ztwo gauge degrees of freedom can be divided into two sublattices, each of which has $N$ degrees of freedom, shown in \prettyref{fig:z2-dividing}.
Actually in order to be consistent with Julia's array indexing convention, we choose \prettyref{fig:z2-dividing-real} as our convention to label the \Ztwo gauge degrees of freedom.
Note that the definition of A sublattice and B sublattice in \prettyref{fig:z2-dividing} is exactly opposite to the definition in \prettyref{fig:z2-dividing-real}.

\begin{figure}
    \centering
    \input{lattice/gauge-sublattice-real.tex}
    \caption{Another way to divide a gauge field configuration into two sublattices, in agreement with Julia's index convention, where \texttt{i} in \texttt{...[i, j]} means $x$ and \texttt{j} means $y$.}
    \label{fig:z2-dividing-real}
\end{figure}

\subsection{Structures and procedures in the implementation}



\section{Simulation of \Ztwo gauge theory with different approaches}

\subsection{Monte Carlo simulation of the pure \Ztwo gauge theory with gauge fixing \eqref{eq:gauge-choice-x}}

It should be kept in mind that the gauge \eqref{eq:gauge-choice-x} is \emph{not} a good gauge choice when a transverse field is introduced.
This section, therefore, is mainly about how wrong it is, and whether predictions that are \emph{valid} under \eqref{eq:gauge-choice-x} - most importantly, no thermal phase transition when $h=0$ - is observed in the numerical simulation.

\subsubsection{The magnetization and the phase diagram}

\begin{figure}
    \centering
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{phase/phase-diagram-transverse-ising-metropolis.PNG}
        \subcaption{}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{phase/phase-diagram-transverse-ising-wolff.PNG}
        \subcaption{}
    \end{subfigure}
    \caption{Magnetization of 1D transverse field Ising chain obtained with different updating algorithms. The $x$ coordinate is $h$ and the $y$ coordinate is $T$. (a) Metropolis algorithm (b) Wolff cluster algorithm. 
    It can be seen that Metropolis algorithm does not work well when $h$ is small.}
    \label{fig:comparision-metropolis-wolff}
\end{figure}

Since $J_x$ and $J_y$ differ a lot, Metropolis algorithm is incapable for the simulation of the anisotropic Ising model.
Cluster update methods - in this project Wolff cluster updating \cite{Wolff_1989} - must be used.
\prettyref{fig:comparision-metropolis-wolff} shows a comparison between Metropolis algorithm and Wolff algorithm, 
where Metropolis algorithm cannot update the system sufficiently when $h=0$, 
since in that case the 2D \cim corresponding to the 1D transverse field Ising chain degenerates into a classical 1D Ising chain due to the vanishing quantum fluctuation, 
so the coupling strength in the temporal direction approaches to infinite.

By calculating the magnetic susceptibility we find there is indeed no thermal phase transition.
It can be seen in \prettyref{fig:comparision-metropolis-wolff} that the magnetization changes quite smoothly in the $T$ direction.
There is a quantum critical point at $T = 0, h = 1$, which agrees with known theoretical results \cite{sachdev_2011}.

\prettyref{fig:comparision-metropolis-wolff} is therefore qualitatively the same as \prettyref{fig:phase-diagram-expected-pure-z2}.
Since \eqref{eq:gauge-choice-x} is wrong, we will not expect the critical point in \prettyref{fig:comparision-metropolis-wolff} agrees with the true critical point of the Ising gauge theory on a square lattice.

\subsubsection{The area law and the perimeter law}

It is kind of surprising - or maybe not that surprising - that under . % TODO

\subsection{Monte Carlo simulation of the pure \Ztwo theory's dual transverse field Ising model}

\subsubsection{Benchmark of the algorithms}

\paragraph{Metropolis and Wolff update for \cim}

\begin{figure}
    \centering
    \begin{subfigure}{0.45\textwidth}
        \includegraphics[width=\textwidth]{../3d-ising-prototype/examples/isotropic/magnetization-metropolis-random-init.PNG}
        \subcaption{Metropolis, random initial configuration}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
        \includegraphics[width=\textwidth]{../3d-ising-prototype/examples/isotropic/magnetization-metropolis-ones-init.PNG}
        \subcaption{Metropolis, initially FM}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
        \includegraphics[width=\textwidth]{../3d-ising-prototype/examples/isotropic/magnetization-wolff-random-init.PNG}
        \subcaption{Wolff, random initial configuration}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
        \includegraphics[width=\textwidth]{../3d-ising-prototype/examples/isotropic/magnetization-wolff-ones-init.PNG}
        \subcaption{Wolff, initially FM}
    \end{subfigure}
    \caption{Simulation of 3D \cim using Metropolis update and Wolff update. The data of the straight lines comes from \cite{Talapov_1996}.}
    \label{fig:3d-cim-benchmark}
\end{figure}

\section{Monte Carlo simulation of the whole model \eqref{eq:proposed-model}}

\bibliographystyle{plain}
\bibliography{note} 

\end{document}